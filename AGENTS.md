# Repository Guidelines

## プロジェクト構成とモジュール整理
機能仕様とデータ要件は常に `requirements.md` を最新ソースとして参照してください。アプリ本体は `src/` に配置し、UI は `src/components/`、チェックイン機能などのユースケースは `src/features/`、Google スプレッドシートとの通信は `src/services/` に切り出します。共有ユーティリティは `src/lib/`、静的アセットや PWA 用ファイルは `public/`、運用ドキュメントは `docs/` にまとめると保守性が高まります。

## ビルド・テスト・開発コマンド
開発チームは Node.js 24 かつ pnpm を前提に統一してください。
- `pnpm install` : クローン直後やブランチ切り替え後に依存関係を再構築。
- `pnpm run dev` : モックデータ経由でローカル開発サーバーを起動。
- `pnpm run build` : リリース前に本番バンドルを生成しビルド成否を確認。
- `pnpm run test` / `pnpm run test:e2e` : 単体・コンポーネント試験と E2E スモーク試験を実行。
- `pnpm run lint` / `pnpm run format` : ESLint と Prettier でスタイルを自動整形。スクリプトを更新した場合は `package.json` に反映してください。

## コーディングスタイルと命名規約

- 以下3原則を守ること
   - YAGNI(You Aren't Gonna Need It): 今必要じゃない機能を作らない
   - DRY(Don't Repeat Yourself): 同じコードを繰り返さない
   - KISS(Keep It Simple Stupid): シンプルに保つ
- TypeScriptはstrictモードを維持してください。
- スプレッドシート列の型定義は `types/` などに明示します。
- コーディングスタイルは以下を徹底します（ESLint + Prettierで強制）:
  - インデントは2スペース
  - シングルクォート
  - 末尾カンマ
- 命名規約は以下の通りとします:
  - Reactコンポーネント名・クラス名：`PascalCase`
  - フック・ユーティリティ関数：`camelCase`
  - 定数：`SCREAMING_SNAKE_CASE`
  - ファイル名：機能単位ごと（例: `src/features/checkin/CheckinPanel.tsx`）
- 環境変数はコード上では `camelCase`、`.env.local` では大文字スネークケースを使用してください。

## テスト指針とTDD（テスト駆動開発）

### TDDサイクル
本プロジェクトは**TDD（Test-Driven Development）**で開発します。以下のサイクルを厳守してください：

1. **Red（失敗するテストを書く）**
   - 実装前に、期待する動作を定義するテストを先に作成
   - テストが失敗することを確認（機能がまだ存在しないため）

2. **Green（テストをパスする最小限の実装）**
   - テストをパスするための最小限のコードを実装
   - この段階では完璧さを求めない

3. **Refactor（リファクタリング）**
   - テストが通る状態を保ちながらコードを改善
   - 重複の除去、可読性の向上、パフォーマンス改善

### テスト作成の原則
- **テストファースト**: 機能実装前に必ずテストを書く
- **1テスト1アサーション**: 各テストは1つの振る舞いのみを検証
- **AAA原則**: Arrange（準備）、Act（実行）、Assert（検証）の構造を明確に
- **独立性**: 各テストは他のテストに依存しない

### カバレッジ目標
- Google Sheets アクセス層はモッククライアントを用いた単体テストで **カバレッジ80%以上** を維持すること
- チェックインUIの主要フローは `@testing-library/react` を使って検証すること
- テストファイルは対象コードと**同じ階層**に `*.test.tsx` 形式で配置すること
- E2E テストは `tests/e2e/` ディレクトリに `*.e2e.ts` 形式で配置すること
- Undo や競合制御は `tests/fixtures/` 内のサンプル行で再現し、回帰防止に利用すること

## Google Sheets と機密情報
スプレッドシート ID、OAuth クライアント ID、モックトークンなどの秘匿情報は `.env.local` に保存し、git には決して含めません。必要スコープと共有手順は `docs/configuration.md` に追記し、レビュー用アカウントにも最小限の読み書き権限のみを付与してください。

## ブランチの作成とコミット

### ブランチ運用

- `main`へのコミットは禁止です
- 以下のルールでブランチを作成してコミットしてください
  - `feature/xxx`: 機能開発
  - `fix/xxx`: バグFix

### コミット

タスクの作業単位で細かくコミットをしてください。

`feat:` や `fix:` など Conventional Commits で意図を明確にしてください。

### コミット前の必須チェック

```bash
# 1. コード品質チェック
pnpm run lint

# 2. テスト実行
pnpm run test
```

## プルリクエストのガイドライン

PR には概要、関連 Issue、目視確認が必要な変更のスクリーンショットまたは実行ログ、実行済みコマンドのチェックリストを含めます。リファクタと機能追加はコミットを分け、レビューしやすいまとまりを意識しましょう。

### プルリクエストのタイトル形式

```
<機能名または修正内容>
```
例：
- `ユーザー認証機能の追加`
- `バグ修正: データベース接続エラーの解決`

### プルリクエストの内容
- **変更内容**: 何を変更したかを明確に記述
- **テスト**: 追加・更新したテストの説明
- **影響範囲**: 他の機能への影響の有無
- **セキュリティ**: セキュリティ上の考慮事項
